<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Music Player</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			background: #0a0a0a;
			color: #e4e4e4;
			min-height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 20px;
		}

		.main-container {
			width: 100%;
			max-width: 500px;
			height: 700px;
			background: #1a1a1a;
			border-radius: 30px;
			border: 1px solid #2a2a2a;
			padding: 40px;
			position: relative;
			overflow: hidden;
			display: flex;
			flex-direction: column;
		}

		.view {
			display: none;
			animation: fadeIn 0.3s ease;
			flex: 1;
			overflow: hidden;
		}

		.view.active {
			display: flex;
			flex-direction: column;
		}

		@keyframes fadeIn {
			from {
				opacity: 0;
				transform: translateY(10px);
			}

			to {
				opacity: 1;
				transform: translateY(0);
			}
		}

		.header {
			text-align: center;
			margin-bottom: 30px;
		}

		.header h1 {
			font-size: 2em;
			background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			background-clip: text;
		}

		.search-box {
			display: flex;
			gap: 10px;
			margin-bottom: 30px;
		}

		.search-box input {
			flex: 1;
			padding: 15px 20px;
			background: rgba(255, 255, 255, 0.1);
			border: 1px solid rgba(255, 255, 255, 0.2);
			border-radius: 25px;
			color: #fff;
			font-size: 16px;
			outline: none;
			transition: all 0.3s;
		}

		.search-box input:focus {
			background: rgba(255, 255, 255, 0.15);
			border-color: #667eea;
		}

		.search-box button {
			padding: 15px 25px;
			background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
			border: none;
			border-radius: 25px;
			color: #fff;
			cursor: pointer;
			font-size: 16px;
			transition: transform 0.2s;
		}

		.search-box button:hover {
			transform: translateY(-2px);
		}

		.results {
			flex: 1;
			overflow-y: auto;
		}

		.results::-webkit-scrollbar {
			width: 6px;
		}

		.results::-webkit-scrollbar-track {
			background: rgba(255, 255, 255, 0.05);
			border-radius: 10px;
		}

		.results::-webkit-scrollbar-thumb {
			background: rgba(255, 255, 255, 0.2);
			border-radius: 10px;
		}

		.song-item {
			display: flex;
			align-items: center;
			padding: 12px;
			margin-bottom: 10px;
			background: rgba(255, 255, 255, 0.05);
			border-radius: 12px;
			cursor: pointer;
			transition: all 0.3s;
			border: 1px solid transparent;
		}

		.song-item:hover {
			background: rgba(255, 255, 255, 0.1);
			border-color: #667eea;
			transform: translateX(5px);
		}

		.song-item img {
			width: 50px;
			height: 50px;
			border-radius: 8px;
			margin-right: 12px;
		}

		.song-info {
			flex: 1;
			min-width: 0;
		}

		.song-title {
			font-weight: 600;
			margin-bottom: 3px;
			color: #fff;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}

		.song-artist {
			font-size: 13px;
			color: #aaa;
			white-space: nowrap;
			overflow: hidden;
			text-overflow: ellipsis;
		}

		.nav-tabs {
			display: flex;
			gap: 10px;
			margin-bottom: 30px;
		}

		.nav-btn {
			flex: 1;
			padding: 12px;
			background: rgba(255, 255, 255, 0.05);
			border: 1px solid rgba(255, 255, 255, 0.1);
			border-radius: 15px;
			color: #aaa;
			cursor: pointer;
			transition: all 0.3s;
			font-size: 14px;
		}

		.nav-btn:hover {
			background: rgba(255, 255, 255, 0.1);
		}

		.nav-btn.active {
			background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
			color: #fff;
			border-color: transparent;
		}

		.content-area {
			flex: 1;
			overflow-y: auto;
			margin-bottom: 15px;
		}

		.content-area::-webkit-scrollbar {
			width: 6px;
		}

		.content-area::-webkit-scrollbar-track {
			background: rgba(255, 255, 255, 0.05);
			border-radius: 10px;
		}

		.content-area::-webkit-scrollbar-thumb {
			background: rgba(255, 255, 255, 0.2);
			border-radius: 10px;
		}

		.album-art {
			width: 200px;
			height: 200px;
			border-radius: 20px;
			margin: 0 auto 25px;
			display: block;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
		}

		.song-details {
			text-align: center;
			margin-bottom: 30px;
		}

		.song-details h2 {
			font-size: 20px;
			margin-bottom: 8px;
			color: #fff;
		}

		.song-details p {
			color: #aaa;
			font-size: 15px;
		}

		#player {
			display: none;
		}

		.controls {
			display: flex;
			justify-content: center;
			align-items: center;
			gap: 15px;
			margin-bottom: 30px;
		}

		.control-btn {
			background: rgba(255, 255, 255, 0.1);
			border: none;
			width: 45px;
			height: 45px;
			border-radius: 50%;
			color: #fff;
			font-size: 16px;
			cursor: pointer;
			transition: all 0.3s;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.control-btn:hover {
			background: rgba(255, 255, 255, 0.2);
			transform: scale(1.1);
		}

		.control-btn.play-pause {
			width: 60px;
			height: 60px;
			background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
			font-size: 20px;
		}

		.progress-container {
			margin-bottom: 20px;
		}

		.time-info {
			display: flex;
			justify-content: space-between;
			margin-bottom: 8px;
			font-size: 13px;
			color: #aaa;
		}

		.progress-bar {
			width: 100%;
			height: 6px;
			background: rgba(255, 255, 255, 0.1);
			border-radius: 3px;
			cursor: pointer;
			position: relative;
		}

		.progress {
			height: 100%;
			background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
			border-radius: 3px;
			width: 0%;
			transition: width 0.1s;
		}

		.lyrics-container {
			height: 100%;
			overflow-y: auto;
			padding: 10px;
		}

		.lyrics-container::-webkit-scrollbar {
			width: 6px;
		}

		.lyrics-container::-webkit-scrollbar-track {
			background: rgba(255, 255, 255, 0.05);
			border-radius: 10px;
		}

		.lyrics-container::-webkit-scrollbar-thumb {
			background: rgba(255, 255, 255, 0.2);
			border-radius: 10px;
		}

		.lyric-line {
			padding: 10px;
			transition: all 0.3s;
			color: #888;
			text-align: center;
			font-size: 15px;
			cursor: pointer;
			border-radius: 8px;
		}

		.lyric-line:hover {
			background: rgba(255, 255, 255, 0.05);
		}

		.lyric-line.active {
			color: #fff;
			font-size: 17px;
			font-weight: 600;
			background: rgba(102, 126, 234, 0.2);
		}

		.loading {
			text-align: center;
			padding: 20px;
			color: #aaa;
		}

		.favorite-btn {
			position: absolute;
			top: 90px;
			right: 40px;
			background: rgba(255, 255, 255, 0.1);
			border: none;
			padding: 8px 12px;
			border-radius: 10px;
			color: #aaa;
			cursor: pointer;
			transition: all 0.3s;
			font-size: 18px;
			z-index: 10;
		}

		.favorite-btn:hover {
			background: rgba(255, 255, 255, 0.2);
			transform: scale(1.1);
		}

		.favorite-btn.active {
			color: #ff4757;
		}

		.favorites-bottom-btn {
			width: 100%;
			padding: 15px;
			background: rgba(255, 255, 255, 0.05);
			border: 1px solid rgba(255, 255, 255, 0.1);
			border-radius: 15px;
			color: #aaa;
			cursor: pointer;
			transition: all 0.3s;
			font-size: 14px;
			margin-top: auto;
		}

		.favorites-bottom-btn:hover {
			background: rgba(255, 255, 255, 0.1);
		}

		.favorites-bottom-btn.active {
			background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
			color: #fff;
			border-color: transparent;
		}
	</style>
</head>

<body>
	<div class="main-container">
		<!-- Initial Search View -->
		<div class="view active" id="initialView">
			<div class="header">
				<h1><i class="fas fa-music"></i> Music Player</h1>
			</div>
			<div class="search-box">
				<input type="text" id="initialSearchInput" placeholder="Search for songs...">
				<button onclick="initialSearch()"><i class="fas fa-search"></i></button>
			</div>
			<div class="results" id="initialResults"></div>
		</div>

		<!-- Player View -->
		<div class="view" id="playerView">
			<button class="favorite-btn" onclick="toggleFavorite()" id="favoriteBtn">
				<i class="far fa-heart"></i>
			</button>

			<div class="nav-tabs">
				<button class="nav-btn active" onclick="showTab('player')">
                    <i class="fas fa-play-circle"></i> Player
                </button>
				<button class="nav-btn" onclick="showTab('lyrics')">
                    <i class="fas fa-align-left"></i> Lyrics
                </button>
				<button class="nav-btn" onclick="showTab('search')">
                    <i class="fas fa-search"></i> Search
                </button>
			</div>

			<div class="content-area">
				<div id="playerTab">
					<img class="album-art" src="https://via.placeholder.com/200?text=No+Song" alt="Album Art" id="albumArt">

					<div class="song-details">
						<h2 id="songTitle">No Song Playing</h2>
						<p id="artistName">Select a song</p>
					</div>

					<div id="player"></div>

					<div class="controls">
						<button class="control-btn" onclick="rewind()"><i class="fas fa-backward"></i></button>
						<button class="control-btn play-pause" onclick="togglePlay()" id="playBtn">
							<i class="fas fa-play"></i>
						</button>
						<button class="control-btn" onclick="forward()"><i class="fas fa-forward"></i></button>
					</div>

					<div class="progress-container">
						<div class="time-info">
							<span id="currentTime">0:00</span>
							<span id="duration">0:00</span>
						</div>
						<div class="progress-bar" onclick="seek(event)">
							<div class="progress" id="progress"></div>
						</div>
					</div>
				</div>

				<div id="lyricsTab" style="display: none;">
					<div class="lyrics-container" id="lyricsContainer">
						<p class="loading">No lyrics available</p>
					</div>
				</div>

				<div id="searchTab" style="display: none;">
					<div class="search-box">
						<input type="text" id="playerSearchInput" placeholder="Search for songs...">
						<button onclick="playerSearch()"><i class="fas fa-search"></i></button>
					</div>
					<div class="results" id="playerResults"></div>
				</div>

				<div id="favoritesTab" style="display: none;">
					<div class="results" id="favoritesResults"></div>
				</div>
			</div>

			<button class="favorites-bottom-btn" onclick="showTab('favorites')" id="favoritesBottomBtn">
				<i class="fas fa-heart"></i> Favorites
			</button>
		</div>
	</div>

	<script src="https://www.youtube.com/iframe_api"></script>
	<script>
		let player;
        let currentSong = null;
        let lyrics = [];
        let lyricsInterval;
        let currentTab = 'player';
        let userScrolling = false;
        let scrollTimeout;
        let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');

        const API_KEY = 'AIzaSyDr-HBIhsKd7HU7wkChRIL2wDmsUBdWkdk';

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '0',
                width: '0',
                playerVars: {
                    'autoplay': 0,
                    'controls': 0
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            console.log('Player ready');
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                document.getElementById('playBtn').innerHTML = '<i class="fas fa-pause"></i>';
                updateProgress();
            } else {
                document.getElementById('playBtn').innerHTML = '<i class="fas fa-play"></i>';
            }
        }

        function showTab(tab) {
            currentTab = tab;
            
            // Update top nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            if (tab !== 'favorites') {
                event.target.closest('.nav-btn').classList.add('active');
            }
            
            // Update bottom favorites button
            const bottomBtn = document.getElementById('favoritesBottomBtn');
            if (tab === 'favorites') {
                bottomBtn.classList.add('active');
            } else {
                bottomBtn.classList.remove('active');
            }

            // Show/hide favorite heart button - only show in player tab
            const favoriteBtn = document.getElementById('favoriteBtn');
            if (tab === 'player') {
                favoriteBtn.style.display = 'block';
            } else {
                favoriteBtn.style.display = 'none';
            }

            // Show correct tab content
            document.getElementById('playerTab').style.display = 'none';
            document.getElementById('lyricsTab').style.display = 'none';
            document.getElementById('searchTab').style.display = 'none';
            document.getElementById('favoritesTab').style.display = 'none';

            if (tab === 'player') {
                document.getElementById('playerTab').style.display = 'block';
            } else if (tab === 'lyrics') {
                document.getElementById('lyricsTab').style.display = 'block';
            } else if (tab === 'search') {
                document.getElementById('searchTab').style.display = 'block';
            } else if (tab === 'favorites') {
                document.getElementById('favoritesTab').style.display = 'block';
                displayFavorites();
            }
        }

        function playerSearch() {
            const query = document.getElementById('playerSearchInput').value;
            if (!query) return;

            const resultsDiv = document.getElementById('playerResults');
            performSearch(query, resultsDiv);
        }

        function displayFavorites() {
            const container = document.getElementById('favoritesResults');
            
            if (favorites.length === 0) {
                container.innerHTML = '<p class="loading">No favorites yet</p>';
                return;
            }

            container.innerHTML = '';
            favorites.forEach(song => {
                const songDiv = document.createElement('div');
                songDiv.className = 'song-item';
                songDiv.innerHTML = `
                    <img src="${song.artworkUrl60}" alt="${song.trackName}">
                    <div class="song-info">
                        <div class="song-title">${song.trackName}</div>
                        <div class="song-artist">${song.artistName}</div>
                    </div>
                `;
                songDiv.onclick = () => playSong(song);
                container.appendChild(songDiv);
            });
        }

        function toggleFavorite() {
            if (!currentSong) return;

            const index = favorites.findIndex(s => s.trackId === currentSong.trackId);
            
            if (index > -1) {
                favorites.splice(index, 1);
                document.getElementById('favoriteBtn').innerHTML = '<i class="far fa-heart"></i>';
                document.getElementById('favoriteBtn').classList.remove('active');
            } else {
                favorites.push(currentSong);
                document.getElementById('favoriteBtn').innerHTML = '<i class="fas fa-heart"></i>';
                document.getElementById('favoriteBtn').classList.add('active');
            }

            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        function updateFavoriteButton() {
            if (!currentSong) return;

            const isFavorite = favorites.some(s => s.trackId === currentSong.trackId);
            const btn = document.getElementById('favoriteBtn');
            
            if (isFavorite) {
                btn.innerHTML = '<i class="fas fa-heart"></i>';
                btn.classList.add('active');
            } else {
                btn.innerHTML = '<i class="far fa-heart"></i>';
                btn.classList.remove('active');
            }
        }

        async function initialSearch() {
            const query = document.getElementById('initialSearchInput').value;
            if (!query) return;

            const resultsDiv = document.getElementById('initialResults');
            await performSearch(query, resultsDiv);
        }

        async function performSearch(query, resultsDiv) {
            resultsDiv.innerHTML = '<p class="loading">Searching...</p>';

            try {
                const response = await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(query)}&entity=song&limit=20`);
                const data = await response.json();

                if (data.results.length === 0) {
                    resultsDiv.innerHTML = '<p class="loading">No results found</p>';
                    return;
                }

                resultsDiv.innerHTML = '';
                data.results.forEach(song => {
                    const songDiv = document.createElement('div');
                    songDiv.className = 'song-item';
                    songDiv.innerHTML = `
                        <img src="${song.artworkUrl60}" alt="${song.trackName}">
                        <div class="song-info">
                            <div class="song-title">${song.trackName}</div>
                            <div class="song-artist">${song.artistName}</div>
                        </div>
                    `;
                    songDiv.onclick = () => playSong(song);
                    resultsDiv.appendChild(songDiv);
                });
            } catch (error) {
                resultsDiv.innerHTML = '<p class="loading">Error searching songs</p>';
            }
        }

        async function playSong(song) {
            currentSong = song;
            
            document.getElementById('initialView').classList.remove('active');
            document.getElementById('playerView').classList.add('active');

            document.getElementById('albumArt').src = song.artworkUrl100.replace('100x100', '600x600');
            document.getElementById('songTitle').textContent = song.trackName;
            document.getElementById('artistName').textContent = song.artistName;

            updateFavoriteButton();

            const videoId = await searchYouTube(song.trackName, song.artistName);
            if (videoId && player && player.loadVideoById) {
                player.loadVideoById(videoId);
                player.playVideo();
            }

            loadLyrics(song.trackName, song.artistName);
        }

        async function searchYouTube(track, artist) {
            try {
                const queries = [
                    `${track} ${artist} audio`,
                    `${track} ${artist} lyrics`,
                    `${track} ${artist} official audio`
                ];
                
                for (const query of queries) {
                    const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&key=${API_KEY}&maxResults=5`);
                    const data = await response.json();
                    
                    if (data.items && data.items.length > 0) {
                        const preferredVideo = data.items.find(item => {
                            const title = item.snippet.title.toLowerCase();
                            return (title.includes('audio') || 
                                    title.includes('lyric') || 
                                    title.includes('official audio')) &&
                                   !title.includes('music video') &&
                                   !title.includes('mv');
                        });
                        
                        if (preferredVideo) {
                            return preferredVideo.id.videoId;
                        }
                    }
                }
                
                const fallbackResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(queries[0])}&type=video&key=${API_KEY}&maxResults=1`);
                const fallbackData = await fallbackResponse.json();
                return fallbackData.items[0]?.id?.videoId;
            } catch (error) {
                console.error('YouTube search error:', error);
                return null;
            }
        }

        async function loadLyrics(track, artist) {
            const container = document.getElementById('lyricsContainer');
            container.innerHTML = '<p class="loading">Loading lyrics...</p>';
            lyrics = [];

            try {
                const response = await fetch(`https://lrclib.net/api/get?artist_name=${encodeURIComponent(artist)}&track_name=${encodeURIComponent(track)}`);
                const data = await response.json();

                if (data.syncedLyrics) {
                    lyrics = parseLyrics(data.syncedLyrics);
                    displayLyrics();
                    startLyricsSync();
                } else if (data.plainLyrics) {
                    container.innerHTML = data.plainLyrics.split('\n').map(line => 
                        `<div class="lyric-line">${line}</div>`
                    ).join('');
                } else {
                    container.innerHTML = '<p class="loading">No lyrics available</p>';
                }
            } catch (error) {
                container.innerHTML = '<p class="loading">Lyrics not found</p>';
            }
        }

        function parseLyrics(syncedLyrics) {
            const lines = syncedLyrics.split('\n');
            return lines.map(line => {
                const match = line.match(/\[(\d+):(\d+\.\d+)\](.*)/);
                if (match) {
                    const minutes = parseInt(match[1]);
                    const seconds = parseFloat(match[2]);
                    const time = minutes * 60 + seconds;
                    return { time, text: match[3].trim() };
                }
                return null;
            }).filter(line => line !== null);
        }

        function displayLyrics() {
            const container = document.getElementById('lyricsContainer');
            container.innerHTML = lyrics.map((line, index) => 
                `<div class="lyric-line" data-index="${index}" data-time="${line.time}" onclick="seekToLyric(${line.time})">${line.text}</div>`
            ).join('');
        }

        function seekToLyric(time) {
            if (player && player.seekTo) {
                player.seekTo(time, true);
                if (player.getPlayerState() !== YT.PlayerState.PLAYING) {
                    player.playVideo();
                }
            }
        }

        function startLyricsSync() {
            if (lyricsInterval) clearInterval(lyricsInterval);
            
            const container = document.getElementById('lyricsContainer');
            
            container.addEventListener('wheel', () => {
                userScrolling = true;
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    userScrolling = false;
                }, 3000);
            });

            container.addEventListener('touchstart', () => {
                userScrolling = true;
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    userScrolling = false;
                }, 3000);
            });
            
            lyricsInterval = setInterval(() => {
                if (!player || !player.getCurrentTime) return;
                
                const currentTime = player.getCurrentTime();
                let activeIndex = -1;

                for (let i = 0; i < lyrics.length; i++) {
                    if (currentTime >= lyrics[i].time) {
                        activeIndex = i;
                    } else {
                        break;
                    }
                }

                document.querySelectorAll('.lyric-line').forEach((line, index) => {
                    if (index === activeIndex) {
                        line.classList.add('active');
                        if (!userScrolling) {
                            line.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    } else {
                        line.classList.remove('active');
                    }
                });
            }, 100);
        }

        function togglePlay() {
            if (!player || !player.getPlayerState) return;
            
            if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                player.pauseVideo();
            } else {
                player.playVideo();
            }
        }

        function rewind() {
            if (player && player.getCurrentTime) {
                player.seekTo(Math.max(0, player.getCurrentTime() - 5), true);
            }
        }

        function forward() {
            if (player && player.getCurrentTime) {
                player.seekTo(player.getCurrentTime() + 5, true);
            }
        }

        function seek(event) {
            if (!player || !player.getDuration) return;
            
            const progressBar = event.currentTarget;
            const percent = event.offsetX / progressBar.offsetWidth;
            const time = percent * player.getDuration();
            player.seekTo(time, true);
        }

        function updateProgress() {
            if (!player || !player.getCurrentTime) return;

            const current = player.getCurrentTime();
            const duration = player.getDuration();
            const percent = (current / duration) * 100;

            document.getElementById('progress').style.width = percent + '%';
            document.getElementById('currentTime').textContent = formatTime(current);
            document.getElementById('duration').textContent = formatTime(duration);

            if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                requestAnimationFrame(updateProgress);
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        document.getElementById('initialSearchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') initialSearch();
        });

        document.getElementById('playerSearchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') playerSearch();
        });
	</script>
</body>

</html>
